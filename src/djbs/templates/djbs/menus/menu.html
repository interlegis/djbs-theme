{% load djbs_extras %}
{% for menu in menu_items %}
  {% if menu.children %}
    <li class="nav-item dropdown">
      <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
        {% icon menu.icon|default:"config" classes="me-2" data_bs_toggle="tooltip" data_bs_title=menu.title %}
        <span class="sidenav-collapsible collapse collapse-horizontal show">{{ menu.title }}</span>
      </a>
      <ul class="dropdown-menu">
        {% for child in menu.children %}
          {% if child.view_name %}
            {% url child.view_name as local_url %}
          {% endif %}
          <li>
            <a class="dropdown-item" href="{% firstof local_url child.external_url '/' %}{% if child.querystr %}?{{ child.querystr }}{% endif %}">
              {% if child.icon %}
                {% icon child.icon classes="me-2" %}
              {% endif %}
              {{ child.title }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </li>
  {% else %}
    {% if menu.view_name %}
      {% url menu.view_name as local_url %}
    {% endif %}
    <li class="nav-item">
      <a class="nav-link{% if item_url in request.path %} active{% endif %}" href="{% firstof local_url menu.external_url '/' %}{% if menu.querystr %}?{{ menu.querystr }}{% endif %}">
        {% icon menu.icon|default:"config" classes="me-2" data_bs_toggle="tooltip" data_bs_title=menu.title %}
        <span class="sidenav-collapsible collapse collapse-horizontal show">{{ menu.title }}</span>
      </a>
    </li>
  {% endif %}
{% endfor %}
